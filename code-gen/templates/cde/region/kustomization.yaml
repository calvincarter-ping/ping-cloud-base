kind: Kustomization
apiVersion: kustomize.config.k8s.io/v1beta1

resources:
- ../base
- pingdirectory
- pingfederate
- pingaccess
- pingdelegator
- custom-resources

generatorOptions: {}

# PingCloud services
# Pingcloud-metadata
#- name: pingcloud-metadata-environment-variables
#  behavior: merge
#  envs:
#  - ../base/env_vars
#  - env_vars

# Pingcloud-healthcheck
#- name: pingcloud-healthcheck-environment-variables
#  behavior: merge
#  envs:
#  - ../base/env_vars
#  - env_vars

configMapGenerator:
- envs:
  - pingdirectory/env_vars
  name: pingdirectory-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingdirectory/env_vars
  name: pingdirectory-environment-variables
- envs:
  - pingdatasync/env_vars
  name: pingdatasync-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingdatasync/env_vars
  name: pingdatasync-environment-variables
- envs:
  - pingfederate/admin/env_vars
  name: pingfederate-admin-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- envs:
  - pingfederate/engine/env_vars
  name: pingfederate-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingfederate/admin/env_vars
  name: pingfederate-admin-environment-variables
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingfederate/engine/env_vars
  name: pingfederate-environment-variables
- envs:
  - pingaccess/admin/env_vars
  name: pingaccess-admin-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- envs:
  - pingaccess/engine/env_vars
  name: pingaccess-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingaccess/admin/env_vars
  name: pingaccess-admin-environment-variables
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingaccess/engine/env_vars
  name: pingaccess-environment-variables
- envs:
  - pingaccess-was/admin/env_vars
  name: pingaccess-was-admin-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- envs:
  - pingaccess-was/engine/env_vars
  name: pingaccess-was-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingaccess-was/admin/env_vars
  name: pingaccess-was-admin-environment-variables
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingaccess-was/engine/env_vars
  name: pingaccess-was-environment-variables
- envs:
  - pingdelegator/env_vars
  name: pingdelegator-last-update-config
  namespace: ${PING_CLOUD_NAMESPACE}
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  - pingdelegator/env_vars
  name: pingdelegator-environment-variables
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  name: cluster-health-environment-variables
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  name: p14c-oauth-service-environment-variables
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  name: p14c-bom-service-environment-variables
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  name: pingcloud-p14c-bootstrap-environment-variables
- behavior: merge
  literals:
  - SERVICE_SSM_PATH_PREFIX=${SERVICE_SSM_PATH_PREFIX}
  - REGION=${REGION}
  name: logging-bootstrap-environment-variables
- behavior: merge
  envs:
  - logging/env_vars
  name: elk-environment-variables
- behavior: merge
  envs:
  - ../base/env_vars
  - env_vars
  name: prometheus-environment-variables

patches:
- patch: custom-patches.yaml
- path: ../base/ping-cloud/pingdirectory/server/remove-from-secondary-patch.yaml
- patch: ../base/ping-cloud/pingaccess-was/admin/remove-from-secondary-patch.yaml
- path: ../base/ping-cloud/pingaccess-was/engine/remove-from-secondary-patch.yaml
- path: ../base/ping-cloud/pingfederate/admin/remove-from-secondary-patch.yaml
- path: ../base/ping-cloud/pingaccess/admin/remove-from-secondary-patch.yaml
- path: ../base/ping-cloud/pingcommon/my-ping/remove-from-secondary-patch.yaml
- path: ../base/ping-cloud/pingdatasync/server/remove-from-secondary-patch.yaml
- patch: ../base/cluster-tools/monitoring/remove-from-secondary-patch.yaml
- patch: ../base/cluster-tools/logging/remove-from-secondary-patch.yaml
- patch: ../base/cluster-tools/health/remove-from-secondary-patch.yaml
- path: pingaccess/ff-external-ingress/remove-external-ingress.yaml
- path: pingdelegator/ff-external-ingress/remove-external-ingress.yaml
- path: pingdirectory/ff-external-ingress/remove-external-ingress.yaml
- path: pingfederate/ff-external-ingress/remove-external-ingress.yaml
- patch: ../base/ping-cloud/pingaccess-was/ff-external-ingress/remove-external-ingress.yaml
 #- ../base/ping-cloud/pingfederate/provisioning/remove-from-secondary-patch.yaml

  ### Developer CDE Environments - the following will be UNCOMMENTED if we are in a developer CDE

  ### CloudWatch is disabled by default in developer CDEs for cost savings
  ### If you want CloudWatch enabled in a developer CDE, make sure the below is commented out *in your CSR*
  # - ../base/cluster-tools/monitoring/remove-from-developer-cde-patch.yaml

  ### NR and CW logging are disabled by default in developer CDEs
  ### If you want NR and CW logging enabled in a developer CDE, make sure the below is commented out *in your CSR*
  # - ../base/cluster-tools/logging/remove-from-developer-cde-patch.yaml
