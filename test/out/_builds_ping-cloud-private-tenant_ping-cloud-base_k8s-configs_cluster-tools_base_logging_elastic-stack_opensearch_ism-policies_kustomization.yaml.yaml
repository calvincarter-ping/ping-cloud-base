apiVersion: v1
data:
  ping-general.json: |-
    {
        "policy": {
            "policy_id": "ping_standard_policy",
            "description": "Standard ping policy (after 7 days read-only, after 90 days shrunk and delete, shrunken index will be processed via shrunken policy)",
            "last_updated_time": 1684846142111,
            "schema_version": 17,
            "error_notification": null,
            "default_state": "hot",
            "states": [
                {
                    "name": "hot",
                    "actions": [],
                    "transitions": [
                        {
                            "state_name": "RO",
                            "conditions": {
                                "min_index_age": "7d"
                            }
                        }
                    ]
                },
                {
                    "name": "RO",
                    "actions": [
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "read_only": {}
                        }
                    ],
                    "transitions": [
                        {
                            "state_name": "delete",
                            "conditions": {
                                "min_index_age": "90d"
                            }
                        }
                    ]
                },
                {
                    "name": "delete",
                    "actions": [
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "shrink": {
                                "num_new_shards": 1,
                                "target_index_name_template": {
                                    "source": "{{ctx.index}}_shrunken",
                                    "lang": "mustache"
                                },
                                "force_unsafe": true
                            }
                        },
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "delete": {}
                        }
                    ],
                    "transitions": []
                }
            ],
            "ism_template": [
                {
                    "index_patterns": [
                        "pd-*",
                        "pf-*",
                        "pa-*",
                        "pc-*",
                        "pdg-*",
                        "ingress-*",
                        "logstash-*"
                    ],
                    "priority": 1,
                    "last_updated_time": 1684842823048
                }
            ]
        }
    }
  ping-healthchecks.json: |-
    {
        "policy": {
            "policy_id": "ping_7day_policy",
            "description": "Ping policy for healthcheck and backup logs(after 7 days delete)",
            "last_updated_time": 1684842849484,
            "schema_version": 17,
            "error_notification": null,
            "default_state": "hot",
            "states": [
                {
                    "name": "hot",
                    "actions": [],
                    "transitions": [
                        {
                            "state_name": "delete",
                            "conditions": {
                                "min_index_age": "7d"
                            }
                        }
                    ]
                },
                {
                    "name": "delete",
                    "actions": [
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "delete": {}
                        }
                    ],
                    "transitions": []
                }
            ],
            "ism_template": [
                {
                    "index_patterns": [
                        "healthchecks-*",
                        "backup-*"
                    ],
                    "priority": 1,
                    "last_updated_time": 1678887761113
                }
            ]
        }
    }
  ping-imported.json: |-
    {
        "policy": {
            "policy_id": "ping_imported",
            "description": "Ping policy for everything imported from ES(after 7 days shrink to 1 shard and delete, shrunken index will be processed via shrunken policy)",
            "last_updated_time": 1684846188882,
            "schema_version": 17,
            "error_notification": null,
            "default_state": "init",
            "states": [
                {
                    "name": "init",
                    "actions": [],
                    "transitions": [
                        {
                            "state_name": "store",
                            "conditions": {
                                "min_index_age": "7d"
                            }
                        }
                    ]
                },
                {
                    "name": "store",
                    "actions": [
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "read_only": {}
                        },
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "shrink": {
                                "num_new_shards": 1,
                                "target_index_name_template": {
                                    "source": "{{ctx.index}}_shrunken",
                                    "lang": "mustache"
                                },
                                "force_unsafe": true
                            }
                        }
                    ],
                    "transitions": [
                        {
                            "state_name": "delete"
                        }
                    ]
                },
                {
                    "name": "delete",
                    "actions": [
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "delete": {}
                        }
                    ],
                    "transitions": []
                }
            ],
            "ism_template": [
                {
                    "index_patterns": [
                        "*-imported"
                    ],
                    "priority": 100,
                    "last_updated_time": 1684841250879
                }
            ]
        }
    }
  ping-shrunken.json: |-
    {
       "policy": {
            "policy_id": "ping_shrunken_policy",
            "description": "Ping policy for shrunken indices(immediately merge, set replica to 0, move to warm, after 180 days delete)",
            "last_updated_time": 1684846300784,
            "schema_version": 17,
            "error_notification": null,
            "default_state": "init",
            "states": [
                {
                    "name": "init",
                    "actions": [
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "replica_count": {
                                "number_of_replicas": 0
                            }
                        },
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "force_merge": {
                                "max_num_segments": 1
                            }
                        },
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "read_only": {}
                        },
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "allocation": {
                                "require": {
                                    "temp": "warm"
                                },
                                "include": {},
                                "exclude": {},
                                "wait_for": false
                            }
                        }
                    ],
                    "transitions": [
                        {
                            "state_name": "delete",
                            "conditions": {
                                "min_index_age": "180d"
                            }
                        }
                    ]
                },
                {
                    "name": "delete",
                    "actions": [
                        {
                            "retry": {
                                "count": 3,
                                "backoff": "exponential",
                                "delay": "1m"
                            },
                            "delete": {}
                        }
                    ],
                    "transitions": []
                }
            ],
            "ism_template": [
                {
                    "index_patterns": [
                        "*_shrunken"
                    ],
                    "priority": 500,
                    "last_updated_time": 1684846300784
                }
            ]
        }
    }
kind: ConfigMap
metadata:
  name: os-ism-policies-745k24kdb4
