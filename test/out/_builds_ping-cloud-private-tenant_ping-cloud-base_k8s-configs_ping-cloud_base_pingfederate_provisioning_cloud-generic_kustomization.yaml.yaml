apiVersion: postgres-operator.crunchydata.com/v1beta1
kind: PostgresCluster
metadata:
  labels:
    app: ping-cloud
  name: pf-provisioning
  namespace: postgres-operator
spec:
  backups:
    pgbackrest:
      global:
        repo1-path: /pingfederate/provisioning
        repo1-retention-full: "256"
      image: public.ecr.aws/r2h3l6e4/pingcloud-clustertools/crunchydata/crunchy-pgbackrest:ubi8-2.41-4
      jobs:
        ttlSecondsAfterFinished: 60
      manual:
        options:
        - --type=full
        repoName: repo1
      repos:
      - name: repo1
      restore:
        enabled: true
        options:
        - --type=default
        repoName: repo1
  image: public.ecr.aws/r2h3l6e4/pingcloud-clustertools/crunchydata/crunchy-postgres:ubi8-14.7-0
  instances:
  - affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - podAffinityTerm:
            labelSelector:
              matchExpressions:
              - key: role
                operator: In
                values:
                - pf-provisioning
            topologyKey: topology.kubernetes.io/zone
          weight: 1
    dataVolumeClaimSpec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
      storageClassName: pgo-gp3
    minAvailable: 1
    name: instance1
    replicas: 3
    resources:
      limits:
        cpu: 2
        memory: 4Gi
      requests:
        cpu: 2
        memory: 2Gi
  metadata:
    labels:
      role: pf-provisioning
  monitoring:
    pgmonitor:
      exporter:
        image: public.ecr.aws/r2h3l6e4/pingcloud-clustertools/crunchydata/crunchy-postgres-exporter:ubi8-5.3.1-0
  postgresVersion: 14
  users:
  - databases:
    - pf-provisioning
    name: pf-service
  - databases:
    - pf-provisioning
    name: ping-beluga-ops
    options: SUPERUSER
