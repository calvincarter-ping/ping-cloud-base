apiVersion: v1
data:
  pd_back_init_fail.json: |-
    {
       "name": "PingDirectory Backend Initialization Failed",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"*backend-initialization-failed*\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992641/ALERT+PingDirectory+Backend+Initialization+Failed+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992641/ALERT+PingDirectory+Backend+Initialization+Failed+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_backend_disabled.json: |-
    {
       "name": "PingDirectory Backend Disabled",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"backend-disabled\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154632299/ALERT+PingDirectory+Backend+Disabled+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154632299/ALERT+PingDirectory+Backend+Disabled+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_critical_alarm.json: |-
    {
      "name": "PingDirectory Critical Alarm",
      "type": "monitor",
      "monitor_type": "bucket_level_monitor",
      "enabled": true,
      "schedule": {
        "period": {
          "unit": "MINUTES",
          "interval": 1
        }
      },
      "inputs": [
        {
          "search": {
            "indices": [
              "pd-errors-*"
            ],
            "query": {
              "size": 0,
              "aggregations": {
                "composite_agg": {
                  "composite": {
                    "sources": [
                      {
                        "cluster_name": {
                          "terms": {
                            "field": "cluster_name.keyword"
                          }
                        }
                      }
                    ]
                  },
                  "aggs": {}
                }
              },
              "query": {
                "bool": {
                  "filter": [
                    {
                      "range": {
                        "@timestamp": {
                          "gte": "{{period_end}}||-90s",
                          "lte": "{{period_end}}",
                          "format": "epoch_millis"
                        }
                      }
                    },
                    {
                      "match_phrase": {
                        "kubernetes.container_name": "pingdirectory"
                      }
                    },
                    {
                      "match_phrase": {
                        "msg": "\"alert type=alarm-critical\""
                      }
                    },
                    {
                       "wildcard": {
                          "severity": {
                             "wildcard": "*error*",
                             "boost": 1
                          }
                       }
                    },
                    {
                      "bool": {
                        "must_not": {
                          "bool": {
                            "filter": [
                              {
                                "bool": {
                                  "should": [
                                    {
                                      "match_phrase": {
                                        "msg": "Database Cache Full"
                                      }
                                    }
                                  ],
                                  "minimum_should_match": 1
                                }
                              },
                              {
                                "bool": {
                                  "should": [
                                    {
                                      "match_phrase": {
                                        "msg": "Backend appintegrations"
                                      }
                                    }
                                  ],
                                  "minimum_should_match": 1
                                }
                              }
                            ]
                          }
                        }
                      }
                    },
                    {
                      "bool": {
                        "must_not": {
                          "bool": {
                            "filter": [
                              {
                                "bool": {
                                  "should": [
                                    {
                                      "match_phrase": {
                                        "msg": "Database Cache Full"
                                      }
                                    }
                                  ],
                                  "minimum_should_match": 1
                                }
                              },
                              {
                                "bool": {
                                  "should": [
                                    {
                                      "match_phrase": {
                                        "msg": "Backend userRoot"
                                      }
                                    }
                                  ],
                                  "minimum_should_match": 1
                                }
                              }
                            ]
                          }
                        }
                      }
                    },
                    {
                      "bool": {
                        "must_not": {
                          "bool": {
                            "filter": [
                              {
                                "bool": {
                                  "should": [
                                    {
                                      "match_phrase": {
                                        "msg": "alert type=alarm-major"
                                      }
                                    }
                                  ],
                                  "minimum_should_match": 1
                                }
                              },
                              {
                                "bool": {
                                  "should": [
                                    {
                                      "match_phrase": {
                                        "msg": "License Expiration"
                                      }
                                    }
                                  ],
                                  "minimum_should_match": 1
                                }
                              }
                            ]
                          }
                        }
                      }
                    },
                    {
                      "bool": {
                        "must_not": {
                          "bool": {
                            "should": [
                              {
                                "match_phrase": {
                                  "msg": "Active Cleaner Threads"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Available File Descriptors"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Changelog Database Target Size"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "CPU Usage"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Database Cache Full"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Backend appintegrations"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Backend userRoot"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Disk Busy"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "HTTP Processing"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "JVM Memory Usage"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "License Expiration"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Purge Expired Data Backlog"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Replication Purge Delay"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Undeletable Database Files"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "Work Queue Size"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        }
      ],
      "triggers": [
        {
          "bucket_level_trigger": {
            "name": "Count more than 0",
            "severity": "1",
            "condition": {
              "buckets_path": {
                "_count": "_count"
              },
              "parent_bucket_path": "composite_agg",
              "script": {
                "source": "params._count > 0",
                "lang": "painless"
              },
              "gap_policy": "skip"
            },
            "actions": [
              {
                "name": "SREAPPALERTS",
                "destination_id": "sns_sreappalerts",
                "message_template": {
                  "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154340442/ALERT+PingDirectory+Critical+Alarm+in+CDE\"\n}",
                  "lang": "mustache"
                },
                "throttle_enabled": false,
                "subject_template": {
                  "source": "ALERT: {{ctx.monitor.name}}",
                  "lang": "mustache"
                },
                "action_execution_policy": {
                  "action_execution_scope": {
                    "per_alert": {
                      "actionable_alerts": [
                        "DEDUPED",
                        "NEW"
                      ]
                    }
                  }
                }
              },
              {
                "name": "CUSTOMERHUB",
                "destination_id": "sns_customerhub",
                "message_template": {
                  "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154340442/ALERT+PingDirectory+Critical+Alarm+in+CDE\"\n}",
                  "lang": "mustache"
                },
                "throttle_enabled": false,
                "subject_template": {
                  "source": "ALERT: {{ctx.monitor.name}}",
                  "lang": "mustache"
                },
                "action_execution_policy": {
                  "action_execution_scope": {
                    "per_alert": {
                      "actionable_alerts": [
                        "DEDUPED",
                        "NEW"
                      ]
                    }
                  }
                }
              }
            ]
          }
        }
      ]
    }
  pd_deadlock.json: |-
    {
       "name": "PingDirectory Deadlock Detected",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"deadlock-detected\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796042/ALERT+PingDirectory+Deadlock+Detected+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796042/ALERT+PingDirectory+Deadlock+Detected+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_ext_init_fail.json: |-
    {
       "name": "PingDirectory External Server Initialization Failed",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"external-server-initialization-failed\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154665104/ALERT+PingDirectory+External+Server+Initialization+Failed+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154665104/ALERT+PingDirectory+External+Server+Initialization+Failed+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_fail_mirror_conf.json: |-
    {
       "name": "PingDirectory Failed Mirror Configuration",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=failed-to-apply-mirrored-configuration\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992659/ALERT+PingDirectory+Failed+Mirror+Configuration+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992659/ALERT+PingDirectory+Failed+Mirror+Configuration+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_garbage_collection.json: |-
    {
       "name": "PingDirectory Continuous Garbage Collection",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=continuous-garbage-collection-detected\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992650/ALERT+PingDirectory+Continuous+Garbage+Collection+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992650/ALERT+PingDirectory+Continuous+Garbage+Collection+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_index_corrupt.json: |-
    {
       "name": "PingDirectory Index Corrupt",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"index-corrupt\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992668/ALERT+PingDirectory+Index+Corrupt+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992668/ALERT+PingDirectory+Index+Corrupt+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_index_degrade.json: |-
    {
       "name": "PingDirectory Index Degraded",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"index-degraded\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796051/ALERT+PingDirectory+Index+Degraded+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796051/ALERT+PingDirectory+Index+Degraded+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_lockdown.json: |-
    {
       "name": "PingDirectory Entering Lockdown Mode",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"*entering-lockdown-mode*\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154632308/ALERT+PingDirectory+Entering+Lockdown+Mode+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154632308/ALERT+PingDirectory+Entering+Lockdown+Mode+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
kind: ConfigMap
metadata:
  name: os-alerts-pd-1
  namespace: elastic-stack-logging
---
apiVersion: v1
data:
  pd_je_recovery.json: |-
    {
       "name": "PingDirectory Je Recovery Required",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"je-recovery-required\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796060/ALERT+PingDirectory+Je+Recovery+Required+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796060/ALERT+PingDirectory+Je+Recovery+Required+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_large_attr_fail.json: |-
    {
       "name": "PingDirectory Large Attribute Update Failure",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"large-attribute-update-failure\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992677/ALERT+PingDirectory+Large+Attribute+Update+Failure+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992677/ALERT+PingDirectory+Large+Attribute+Update+Failure+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_ldap_conn_fails.json: |-
    {
       "name": "PingDirectory LDAP Connection Handler Consecutive Failure",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"ldap-connection-handler-consecutive-failures\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796078/ALERT+PingDirectory+LDAP+Connection+Handler+Consecutive+Failure+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796078/ALERT+PingDirectory+LDAP+Connection+Handler+Consecutive+Failure+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_ldap_start_err.json: |-
    {
       "name": "PingDirectory LDAP Connection Handler Startup Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=ldap-connection-handler-cannot-listen\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796069/ALERT+PingDirectory+LDAP+Connection+Handler+Startup+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796069/ALERT+PingDirectory+LDAP+Connection+Handler+Startup+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_ldap_uncaught_err.json: |-
    {
       "name": "PingDirectory LDAP Connection Handler Uncaught Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"ldap-connection-handler-uncaught-error\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992686/ALERT+PingDirectory+LDAP+Connection+Handler+Uncaught+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992686/ALERT+PingDirectory+LDAP+Connection+Handler+Uncaught+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_low_disk.json: |-
    {
       "name": "PingDirectory Low Disk Space Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"low-disk-space-error\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992695/ALERT+PingDirectory+Low+Disk+Space+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992695/ALERT+PingDirectory+Low+Disk+Space+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_low_disk_warn.json: |-
    {
       "name": "PingDirectory Low Disk Space Warning",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"low-disk-space-warning\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796087/ALERT+PingDirectory+Low+Disk+Space+Warning+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796087/ALERT+PingDirectory+Low+Disk+Space+Warning+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_major_alarm.json: |-
    {
      "name": "PingDirectory Major Alarm",
      "type": "monitor",
      "monitor_type": "bucket_level_monitor",
      "enabled": true,
      "schedule": {
        "period": {
          "unit": "MINUTES",
          "interval": 1
        }
      },
      "inputs": [
        {
          "search": {
            "indices": [
              "pd-errors-*"
            ],
            "query": {
              "size": 0,
              "query": {
                "bool": {
                  "filter": [
                    {
                      "range": {
                        "@timestamp": {
                          "from": "{{period_end}}||-90s",
                          "to": "{{period_end}}",
                          "include_lower": true,
                          "include_upper": true,
                          "format": "epoch_millis",
                          "boost": 1
                        }
                      }
                    },
                    {
                      "match_phrase": {
                        "kubernetes.container_name": {
                          "query": "pingdirectory",
                          "slop": 0,
                          "zero_terms_query": "NONE",
                          "boost": 1
                        }
                      }
                    },
                    {
                       "wildcard": {
                          "severity": {
                             "wildcard": "*warning*",
                             "boost": 1
                          }
                       }
                    },
                    {
                      "match_phrase": {
                        "msg": {
                          "query": "\"alert type=alarm-major\"",
                          "slop": 0,
                          "zero_terms_query": "NONE",
                          "boost": 1
                        }
                      }
                    },
                    {
                      "bool": {
                        "must_not": {
                          "bool": {
                            "should": [
                              {
                                "match_phrase": {
                                  "msg": "Certificate Expiration"
                                }
                              },
                              {
                                "match_phrase": {
                                  "msg": "License Expiration"
                                }
                              }
                            ],
                            "minimum_should_match": 1
                          }
                        }
                      }
                    }
                  ],
                  "adjust_pure_negative": true,
                  "boost": 1
                }
              },
              "aggregations": {
                "composite_agg": {
                  "composite": {
                    "size": 10,
                    "sources": [
                      {
                        "cluster_name": {
                          "terms": {
                            "field": "cluster_name.keyword",
                            "missing_bucket": false,
                            "order": "asc"
                          }
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      ],
      "triggers": [
        {
          "bucket_level_trigger": {
            "name": "Count more than 0",
            "severity": "1",
            "condition": {
              "buckets_path": {
                "_count": "_count"
              },
              "parent_bucket_path": "composite_agg",
              "script": {
                "source": "params._count > 0",
                "lang": "painless"
              },
              "gap_policy": "skip"
            },
            "actions": [
              {
                "name": "SREAPPALERTS",
                "destination_id": "sns_sreappalerts",
                "message_template": {
                  "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796033/ALERT+PingDirectory+Major+Alarm+in+CDE\"\n}",
                  "lang": "mustache"
                },
                "throttle_enabled": false,
                "subject_template": {
                  "source": "ALERT: {{ctx.monitor.name}}",
                  "lang": "mustache"
                },
                "action_execution_policy": {
                  "action_execution_scope": {
                    "per_alert": {
                      "actionable_alerts": [
                        "DEDUPED",
                        "NEW"
                      ]
                    }
                  }
                }
              },
              {
                "name": "CUSTOMERHUB",
                "destination_id": "sns_customerhub",
                "message_template": {
                  "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796033/ALERT+PingDirectory+Major+Alarm+in+CDE\"\n}",
                  "lang": "mustache"
                },
                "throttle_enabled": false,
                "subject_template": {
                  "source": "ALERT: {{ctx.monitor.name}}",
                  "lang": "mustache"
                },
                "action_execution_policy": {
                  "action_execution_scope": {
                    "per_alert": {
                      "actionable_alerts": [
                        "DEDUPED",
                        "NEW"
                      ]
                    }
                  }
                }
              }
            ]
          }
        }
      ]
    }
  pd_out_of_disk.json: |-
    {
       "name": "PingDirectory Out-of-disk Space Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"out-of-disk-space-error\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796096/ALERT+PingDirectory+Out-of-disk+Space+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796096/ALERT+PingDirectory+Out-of-disk+Space+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_priv_assign.json: |-
    {
       "name": "PingDirectory Privilege Assigned",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"privilege-assigned\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992704/ALERT+PingDirectory+Privilege+Assigned+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992704/ALERT+PingDirectory+Privilege+Assigned+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
kind: ConfigMap
metadata:
  name: os-alerts-pd-2
  namespace: elastic-stack-logging
---
apiVersion: v1
data:
  pd_3rd_party_ext.json: |-
    {
       "name": "PingDirectory Third Party Extension Exception",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=third-party-extension-exception\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796123/ALERT+PingDirectory+Third+Party+Extension+Exception+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796123/ALERT+PingDirectory+Third+Party+Extension+Exception+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_cert_replace_fail.json: |-
    {
       "name": "PingDirectory Replace Certificate Failed",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "replace-certificate-failed"
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992712/ALERT+PingDirectory+Replace+Certificate+Failed+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992712/ALERT+PingDirectory+Replace+Certificate+Failed+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_repl_backlog.json: |-
    {
       "name": "PingDirectory Replication Backlogged",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=replication-backlogged\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992720/ALERT+PingDirectory+Replication+Backlogged+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992720/ALERT+PingDirectory+Replication+Backlogged+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_repl_changelog_fail.json: |-
    {
       "name": "PingDirectory Replication Changelog Failure",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=replication-server-changelog-failure\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992737/ALERT+PingDirectory+Replication+Changelog+Failure+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992737/ALERT+PingDirectory+Replication+Changelog+Failure+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_repl_genid_mismatch.json: |-
    {
       "name": "PingDirectory Replication Generation-id Mismatch",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"replication-generation-id-mismatch\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992728/ALERT+PingDirectory+Replication+Generation-id+Mismatch+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992728/ALERT+PingDirectory+Replication+Generation-id+Mismatch+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_repl_missing_changes.json: |-
    {
       "name": "PingDirectory Replication Missing Changes",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=replication-missing-changes\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796105/ALERT+PingDirectory+Replication+Missing+Changes+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796105/ALERT+PingDirectory+Replication+Missing+Changes+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_repl_replay_fail.json: |-
    {
       "name": "PingDirectory Replication Replay Operation Failed",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=replication-replay-failed\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796114/ALERT+PingDirectory+Replication+Replay+Operation+Failed+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796114/ALERT+PingDirectory+Replication+Replay+Operation+Failed+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_repl_server_fail.json: |-
    {
       "name": "PingDirectory Replication Server Failure",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=replication-server-listen-failure\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992745/ALERT+PingDirectory+Replication+Server+Failure+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992745/ALERT+PingDirectory+Replication+Server+Failure+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_uncaught.json: |-
    {
       "name": "PingDirectory Uncaught Exception",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"uncaught-exception\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796131/ALERT+PingDirectory+Uncaught+Exception+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796131/ALERT+PingDirectory+Uncaught+Exception+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_unresolved_repl_conflict.json: |-
    {
       "name": "PingDirectory Unresolved Replication Conflict",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=replication-unresolved-conflict\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992753/ALERT+PingDirectory+Unresolved+Replication+Conflict+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992753/ALERT+PingDirectory+Unresolved+Replication+Conflict+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
kind: ConfigMap
metadata:
  name: os-alerts-pd-3
  namespace: elastic-stack-logging
---
apiVersion: v1
data:
  pd_active_cleaner_threads.json: |-
    {
       "name": "PingDirectory Active Cleaner Threads",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.labels.role": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Active Cleaner Threads\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_available_file_descriptors.json: |-
    {
       "name": "PingDirectory Available File Descriptors",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.labels.role": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Available File Descriptors\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_changelog_database_target_size.json: |-
    {
       "name": "PingDirectory Changelog Database Target Size",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.labels.role": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Changelog Database Target Size\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_cpu_usage.json: |-
    {
       "name": "PingDirectory CPU Usage",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"CPU Usage\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_db_cache_full_appintegrations.json: |-
    {
       "name": "PingDirectory Database Cache Full - Backend appintegrations",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Database Cache Full\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Backend appintegrations\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_user_err.json: |-
    {
       "name": "PingDirectory User-defined Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"user-defined-error\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796139/ALERT+PingDirectory+User-defined+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796139/ALERT+PingDirectory+User-defined+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_user_fatal.json: |-
    {
       "name": "PingDirectory User-defined Fatal",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"user-defined-fatal\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796147/ALERT+PingDirectory+User-defined+Fatal+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796147/ALERT+PingDirectory+User-defined+Fatal+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_work_queue_back.json: |-
    {
       "name": "PingDirectory Work Queue Backlogged",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"work-queue-backlogged\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992761/ALERT+PingDirectory+Work+Queue+Backlogged+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992761/ALERT+PingDirectory+Work+Queue+Backlogged+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_work_queue_full.json: |-
    {
       "name": "PingDirectory Work Queue Full",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"work-queue-full\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796155/ALERT+PingDirectory+Work+Queue+Full+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796155/ALERT+PingDirectory+Work+Queue+Full+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_worker_threads_termin.json: |-
    {
       "name": "PingDirectory Worker Threads Terminated",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"alert type=work-queue-no-threads-remaining\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992769/ALERT+PingDirectory+Worker+Threads+Terminated+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992769/ALERT+PingDirectory+Worker+Threads+Terminated+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
kind: ConfigMap
metadata:
  name: os-alerts-pd-4
  namespace: elastic-stack-logging
---
apiVersion: v1
data:
  pd_db_cache_full_userroot.json: |-
    {
       "name": "PingDirectory Database Cache Full - Backend userRoot",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.labels.role": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Database Cache Full\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Backend userRoot\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_disk_busy.json: |-
    {
       "name": "PingDirectory Disk Busy",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.labels.role": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Disk Busy\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_http_processing.json: |-
    {
       "name": "PingDirectory HTTP Processing",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.labels.role": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"HTTP Processing\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_jvm_mem_usage.json: |-
    {
       "name": "PingDirectory JVM Memory Usage",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.labels.role": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"JVM Memory Usage\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_license_exp_crit.json: |-
    {
       "name": "PingDirectory License Expiration - Critical",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"License Expiration\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_license_exp_major.json: |-
    {
       "name": "PingDirectory License Expiration - Major",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.labels.role": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-major\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"License Expiration\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_purge_expired_data_backlog.json: |-
    {
       "name": "PingDirectory Purge Expired Data Backlog",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Purge Expired Data Backlog\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_repl_purge_delay.json: |-
    {
       "name": "PingDirectory Replication Purge Delay",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Replication Purge Delay\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_undeletable_db_files.json: |-
    {
       "name": "PingDirectory Undeletable Database Files",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Undeletable Database Files\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pd_work_q_size.json: |-
    {
       "name": "PingDirectory Work Queue Size",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pd-errors-*"
                ],
                "query": {
                   "size": 0,
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "from": "{{period_end}}||-90s",
                                     "to": "{{period_end}}",
                                     "include_lower": true,
                                     "include_upper": true,
                                     "format": "epoch_millis",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdirectory"
                              }
                            },
                            {
                               "wildcard": {
                                  "severity": {
                                     "wildcard": "*error*",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"type=alarm-critical\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                  "msg": {
                                     "query": "\"Work Queue Size\"",
                                     "slop": 0,
                                     "zero_terms_query": "NONE",
                                     "boost": 1
                                  }
                               }
                            }
                         ],
                         "adjust_pure_negative": true,
                         "boost": 1
                      }
                   },
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "size": 10,
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword",
                                        "missing_bucket": false,
                                        "order": "asc"
                                     }
                                  }
                               }
                            ]
                         }
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
kind: ConfigMap
metadata:
  name: os-alerts-pd-5
  namespace: elastic-stack-logging
---
apiVersion: v1
data:
  pds_conn_error.json: |-
    {
       "name": "PingDataSync Sync Resource Connection Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pds-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdatasync"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"sync-resource-connection-error\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 1",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 1",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796163/ALERT+PingDataSync+Sync+Resource+Connection+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796163/ALERT+PingDataSync+Sync+Resource+Connection+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pds_ops_error.json: |-
    {
       "name": "PingDataSync Sync Resource Operation Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pds-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdatasync"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"sync-resource-operation-error\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992777/ALERT+PingDataSync+Sync+Resource+Operation+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992777/ALERT+PingDataSync+Sync+Resource+Operation+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pds_pipe_backlog.json: |-
    {
       "name": "PingDataSync Sync Pipe Backlog Above Threshold",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pds-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdatasync"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"sync-pipe-backlog-above-threshold\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796171/ALERT+PingDataSync+Sync+Pipe+Backlog+Above+Threshold+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796171/ALERT+PingDataSync+Sync+Pipe+Backlog+Above+Threshold+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pds_user_err.json: |-
    {
       "name": "PingDataSync User-defined Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pds-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdatasync"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"user-defined-error\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796187/ALERT+PingDataSync+User-defined+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796187/ALERT+PingDataSync+User-defined+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pds_user_fatal.json: |-
    {
       "name": "PingDataSync User-defined Fatal",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pds-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdatasync"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"user-defined-fatal\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992785/ALERT+PingDataSync+User-defined+Fatal+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992785/ALERT+PingDataSync+User-defined+Fatal+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pds_work_queue_back.json: |-
    {
       "name": "PingDataSync Work Queue Backlogged",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pds-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdatasync"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"work-queue-backlogged\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992793/ALERT+PingDataSync+Work+Queue+Backlogged+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992793/ALERT+PingDataSync+Work+Queue+Backlogged+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pds_work_queue_full.json: |-
    {
       "name": "PingDataSync Work Queue Full",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pds-errors-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "match_phrase": {
                                "kubernetes.container_name": "pingdatasync"
                              }
                            },
                            {
                              "match_phrase": {
                                "msg": "\"work-queue-full\""
                              }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796195/ALERT+PingDataSync+Work+Queue+Full+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796195/ALERT+PingDataSync+Work+Queue+Full+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
kind: ConfigMap
metadata:
  name: os-alerts-pds
  namespace: elastic-stack-logging
---
apiVersion: v1
data:
  pf_authn_exception.json: |-
    {
       "name": "PingFederate Authn Exception",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pf-server-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "term": {
                                "className.keyword": "org.sourceid.saml20.profiles.idp.HandleAuthnRequest"
                              }
                            },
                            {
                               "match_phrase": {
                                 "message": "Exception"
                               }
                             },
                             {
                               "term": {
                                 "kubernetes.labels.role.keyword": "pingfederate-engine"
                               }
                             }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 1",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 1",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992810/ALERT+PingFederate+Authn+Exception+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pf_fatal.json: |-
    {
       "name": "PingFederate Fatal Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pf-server-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "term": {
                                "logLevel.keyword": "FATAL"
                              }
                            },
                            {
                               "term": {
                                 "kubernetes.labels.role.keyword": "pingfederate-engine"
                               }
                            }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 0",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 0",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                        "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992818/ALERT+PingFederate+Fatal+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                        "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992818/ALERT+PingFederate+Fatal+Error+in+CDE\"\n}",                     "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pf_invalid_req.json: |-
    {
       "name": "PingFederate Invalid Request Parameter",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pf-server-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "term": {
                                "className.keyword": "org.sourceid.websso.servlet.reqparam.InvalidRequestParameterException"
                              }
                            },
                            {
                              "term": {
                                "logLevel.keyword": "ERROR"
                               }
                             },
                             {
                               "term": {
                                 "kubernetes.labels.role.keyword": "pingfederate-engine"
                               }
                             }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 1",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 1",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796212/ALERT+PingFederate+Invalid+Request+Parameter+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pf_ldap_conn_lost.json: |-
    {
       "name": "PingFederate LDAP Connection Lost",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pf-server-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                              "term": {
                                "className.keyword": "javax.naming.NamingException"
                              }
                            },
                            {
                               "match_phrase": {
                                 "message": "error code 91"
                               }
                             },
                             {
                               "term": {
                                 "logLevel.keyword": "ERROR"
                               }
                             },
                             {
                               "term": {
                                 "kubernetes.labels.role.keyword": "pingfederate-engine"
                               }
                             }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 1",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 1",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992826/ALERT+PingFederate+LDAP+Connection+Lost+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992826/ALERT+PingFederate+LDAP+Connection+Lost+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pf_missing_id.json: |-
    {
       "name": "PingFederate Profile Message Missing ID",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pf-server-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                               "match_phrase": {
                                 "message": "Profile Message ID Missing"
                               }
                             },
                             {
                               "term": {
                                 "kubernetes.labels.role.keyword": "pingfederate-engine"
                               }
                             }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 1",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 1",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796228/ALERT+PingFederate+Profile+Message+Missing+ID+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796228/ALERT+PingFederate+Profile+Message+Missing+ID+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pf_pingid_conn_lost.json: |-
    {
       "name": "PingFederate PingID Connection Lost",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pf-server-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                               "term": {
                                 "className.keyword": "com.pingidentity.adapters.pingid.DefaultHeartbeatService"
                               }
                             },
                             {
                                "match_phrase": {
                                  "message": "Connection refused"
                                }
                              },
                              {
                                "term": {
                                  "logLevel.keyword": "ERROR"
                                }
                              },
                              {
                                "term": {
                                  "kubernetes.labels.role.keyword": "pingfederate-engine"
                                }
                              }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 1",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 1",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796220/ALERT+PingFederate+PingID+Connection+Lost+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154796220/ALERT+PingFederate+PingID+Connection+Lost+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
  pf_unexpected_runtime.json: |-
    {
       "name": "PingFederate Unexpected Runtime Error",
       "type": "monitor",
       "monitor_type": "bucket_level_monitor",
       "enabled": true,
       "schedule": {
          "period": {
             "unit": "MINUTES",
             "interval": 1
          }
       },
       "inputs": [
          {
             "search": {
                "indices": [
                   "pf-server-*"
                ],
                "query": {
                   "size": 0,
                   "aggregations": {
                      "composite_agg": {
                         "composite": {
                            "sources": [
                               {
                                  "cluster_name": {
                                     "terms": {
                                        "field": "cluster_name.keyword"
                                     }
                                  }
                               }
                            ]
                         },
                         "aggs": {}
                      }
                   },
                   "query": {
                      "bool": {
                         "filter": [
                            {
                               "range": {
                                  "@timestamp": {
                                     "gte": "{{period_end}}||-90s",
                                     "lte": "{{period_end}}",
                                     "format": "epoch_millis"
                                  }
                               }
                            },
                            {
                               "term": {
                                 "className.keyword": "org.sourceid.saml20.profiles.idp.HandleAuthnRequest"
                               }
                             },
                             {
                                "match_phrase": {
                                  "message": "Unexpected Runtime Authn Integration Problem"
                                }
                              },
                              {
                                "term": {
                                  "kubernetes.labels.role.keyword": "pingfederate-engine"
                                }
                              }
                         ]
                      }
                   }
                }
             }
          }
       ],
       "triggers": [
          {
             "bucket_level_trigger": {
                "name": "Count more than 1",
                "severity": "1",
                "condition": {
                   "buckets_path": {
                      "_count": "_count"
                   },
                   "parent_bucket_path": "composite_agg",
                   "script": {
                      "source": "params._count > 1",
                      "lang": "painless"
                   },
                   "gap_policy": "skip"
                },
                "actions": [
                  {
                        "name": "SREAPPALERTS",
                        "destination_id": "sns_sreappalerts",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992834/ALERT+PingFederate+Unexpected+Runtime+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      },
                   {
                        "name": "CUSTOMERHUB",
                        "destination_id": "sns_customerhub",
                        "message_template": {
                          "source": "{\n  \"alert\": \"{{ctx.monitor.name}}\",\n  \"documents\": {{ctx.results.0.hits.total.value}},\n  \"cluster\": \"{{#ctx.newAlerts}}{{bucket_keys}}{{/ctx.newAlerts}}{{#ctx.dedupedAlerts}}{{bucket_keys}}{{/ctx.dedupedAlerts}}\",\n  \"timestamp\": \"{{ctx.periodEnd}}\",\n  \"runbook\": \"https://pingidentity.atlassian.net/wiki/spaces/ST/pages/154992834/ALERT+PingFederate+Unexpected+Runtime+Error+in+CDE\"\n}",
                          "lang": "mustache"
                        },
                        "throttle_enabled": false,
                        "subject_template": {
                          "source": "ALERT: {{ctx.monitor.name}}",
                          "lang": "mustache"
                        },
                        "action_execution_policy": {
                          "action_execution_scope": {
                            "per_alert": {
                              "actionable_alerts": [
                                "DEDUPED",
                                "NEW"
                              ]
                            }
                          }
                        }
                      }
                  ]
             }
          }
       ]
    }
kind: ConfigMap
metadata:
  name: os-alerts-pf
  namespace: elastic-stack-logging
