apiVersion: v1
kind: Secret
metadata:
  annotations:
    argocd.argoproj.io/sync-options: Prune=false
  name: opensearch-securityconfig
data:
  action_groups.yml: |-
    _meta:
        type: "actiongroups"
        config_version: 2
  audit.yml: |-
    _meta:
        type: "audit"
        config_version: 2

    config:
        # enable/disable audit logging
        enabled: true

        audit:
        # Enable/disable REST API auditing
        enable_rest: true

        # Categories to exclude from REST API auditing
        disabled_rest_categories:
            - AUTHENTICATED
            - GRANTED_PRIVILEGES

        # Enable/disable Transport API auditing
        enable_transport: true

        # Categories to exclude from Transport API auditing
        disabled_transport_categories:
            - AUTHENTICATED
            - GRANTED_PRIVILEGES

        # Users to be excluded from auditing. Wildcard patterns are supported. Eg:
        # ignore_users: ["test-user", "employee-*"]
        ignore_users:
            - kibanaserver
            - logstash

        # Requests to be excluded from auditing. Wildcard patterns are supported. Eg:
        # ignore_requests: ["indices:data/read/*", "SearchRequest"]
        ignore_requests: []

        # Log individual operations in a bulk request
        resolve_bulk_requests: false

        # Include the body of the request (if available) for both REST and the transport layer
        log_request_body: true

        # Logs all indices affected by a request. Resolves aliases and wildcards/date patterns
        resolve_indices: true

        # Exclude sensitive headers from being included in the logs. Eg: Authorization
        exclude_sensitive_headers: true

        compliance:
        # enable/disable compliance
        enabled: true

        # Log updates to internal security changes
        internal_config: true

        # Log external config files for the node
        external_config: false

        # Log only metadata of the document for read events
        read_metadata_only: true

        # Map of indexes and fields to monitor for read events. Wildcard patterns are supported for both index names and fields. Eg:
        # read_watched_fields: {
        #   "twitter": ["message"[]
        #   "logs-*": ["id", "attr*"]
        # }
        read_watched_fields: {}

        # List of users to ignore for read events. Wildcard patterns are supported. Eg:
        # read_ignore_users: ["test-user", "employee-*"]
        read_ignore_users:
            - kibanaserver
            - logstash

        # Log only metadata of the document for write events
        write_metadata_only: true

        # Log only diffs for document updates
        write_log_diffs: false

        # List of indices to watch for write events. Wildcard patterns are supported
        # write_watched_indices: ["twitter", "logs-*"]
        write_watched_indices: []

        # List of users to ignore for write events. Wildcard patterns are supported. Eg:
        # write_ignore_users: ["test-user", "employee-*"]
        write_ignore_users:
            - kibanaserver
            - logstash
  config.yml: |
    _meta:
        config_version: 2
        type: config
    config:
        dynamic:
        authc:
            basic_internal_auth_domain:
            authentication_backend:
                type: internal
            http_enabled: true
            description: Authenticate via HTTP Basic against internal users database
            http_authenticator:
                challenge: false
                type: basic
            order: 0
            transport_enabled: true
            openid_auth_domain:
            authentication_backend:
                type: noop
            http_authenticator:
                challenge: false
                config:
                openid_connect_url: https://auth-staging.pingone.com/b9b5b6f5-3440-4adc-8dc4-46593f1263f7/as/.well-known/openid-configuration
                roles_key: groups
                subject_key: name
                type: openid
            http_enabled: true
            order: 1
            transport_enabled: true
        http:
            anonymous_auth_enabled: false
            xff:
              enabled: false
              internalProxies: 192\.168\.0\.10|192\.168\.0\.11
        kibana:
            index: .kibana
            multitenancy_enabled: false
            server_username: kibanaserver
  internal_users.yml: |-
    _meta:
        type: "internalusers"
        config_version: 2

    # Define your internal users here


    admin:
        hash: "$2y$12$x0W/bb.rCExntDszzTQMGO46BjhcabBlY/j44cLQlQgpNCPImb00m"
        reserved: true
        backend_roles:
        - "admin"
        description: "Admin user"

    kibanaserver:
        hash: "$2y$12$KLiCHmtIiXpojpsriqFBBedlHyuOB6QSWFK932S1DELwzKdZ0ioAq"
        reserved: true
        description: "OpenSearch Dashboards user"

    logstash:
        hash: "$2y$12$eTCIRWius.Lix5/5zwJwHOJCqILQmaWDRx6fn3IDR54K59snwlURa"
        reserved: true
        backend_roles:
        - "logstash"
        description: "Logstash user"


    indexmigration:
        hash: "$2y$12$nnNxuzpFcBlpO/FesnUA7O8oZRFF.zBZaBpKKk0zeokYOzq.Y4plu"
        reserved: true
        description: "Index migration user"

    bootstrap:
        hash: "$2y$12$rKbj1eVYptD9uw5B7COX4uOKffCoTLaDwZftW8VKVwZmmT4mJRWsy"
        reserved: true
        description: "Bootstrap user"
  nodes_dn.yml: |-
    _meta:
        type: "nodesdn"
        config_version: 2
  roles.yml: |
    _meta:
        type: "roles"
        config_version: 2

    # Restrict users so they can only view visualization and dashboard on OpenSearchDashboards
    kibana_read_only:
        reserved: true

    logstash_write:
        reserved: true
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - 'crud'
            - 'create_index'

    # The security REST API access role is used to assign specific users access to change the security settings through the REST API.
    security_rest_api_access:
        reserved: true

    # Allows users to view monitors, destinations and alerts
    alerting_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/alerting/alerts/get'
        - 'cluster:admin/opendistro/alerting/destination/get'
        - 'cluster:admin/opendistro/alerting/destination/email_group/search'
        - 'cluster:admin/opendistro/alerting/destination/email_account/search'
        - 'cluster:admin/opendistro/alerting/monitor/get'
        - 'cluster:admin/opendistro/alerting/monitor/search'

    # Allows users to view and acknowledge alerts
    alerting_ack_alerts:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/alerting/alerts/*'

    # Allows users to use all alerting functionality
    alerting_full_access:
        reserved: true
        cluster_permissions:
        - 'cluster_monitor'
        - 'cluster:admin/opendistro/alerting/*'
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - 'indices_monitor'
            - 'indices:admin/aliases/get'
            - 'indices:admin/mappings/get'

    # Allow users to read Anomaly Detection detectors and results
    anomaly_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/ad/detector/info'
        - 'cluster:admin/opendistro/ad/detector/search'
        - 'cluster:admin/opendistro/ad/detectors/get'
        - 'cluster:admin/opendistro/ad/result/search'
        - 'cluster:admin/opendistro/ad/tasks/search'
        - 'cluster:admin/opendistro/ad/detector/validate'
        - 'cluster:admin/opendistro/ad/result/topAnomalies'

    # Allows users to use all Anomaly Detection functionality
    anomaly_full_access:
        reserved: true
        cluster_permissions:
        - 'cluster_monitor'
        - 'cluster:admin/opendistro/ad/*'
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - 'indices_monitor'
            - 'indices:admin/aliases/get'
            - 'indices:admin/mappings/get'

    # Allows users to read Notebooks
    notebooks_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/notebooks/list'
        - 'cluster:admin/opendistro/notebooks/get'

    # Allows users to all Notebooks functionality
    notebooks_full_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/notebooks/create'
        - 'cluster:admin/opendistro/notebooks/update'
        - 'cluster:admin/opendistro/notebooks/delete'
        - 'cluster:admin/opendistro/notebooks/get'
        - 'cluster:admin/opendistro/notebooks/list'

    # Allows users to read observability objects
    observability_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opensearch/observability/get'
        - 'cluster:admin/opensearch/ppl'

    # Allows users to all Observability functionality
    observability_full_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opensearch/observability/create'
        - 'cluster:admin/opensearch/observability/update'
        - 'cluster:admin/opensearch/observability/delete'
        - 'cluster:admin/opensearch/observability/get'

    # Allows users to read and download Reports
    reports_instances_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/reports/instance/list'
        - 'cluster:admin/opendistro/reports/instance/get'
        - 'cluster:admin/opendistro/reports/menu/download'

    # Allows users to read and download Reports and Report-definitions
    reports_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/reports/definition/get'
        - 'cluster:admin/opendistro/reports/definition/list'
        - 'cluster:admin/opendistro/reports/instance/list'
        - 'cluster:admin/opendistro/reports/instance/get'
        - 'cluster:admin/opendistro/reports/menu/download'

    # Allows users to all Reports functionality
    reports_full_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/reports/definition/create'
        - 'cluster:admin/opendistro/reports/definition/update'
        - 'cluster:admin/opendistro/reports/definition/on_demand'
        - 'cluster:admin/opendistro/reports/definition/delete'
        - 'cluster:admin/opendistro/reports/definition/get'
        - 'cluster:admin/opendistro/reports/definition/list'
        - 'cluster:admin/opendistro/reports/instance/list'
        - 'cluster:admin/opendistro/reports/instance/get'
        - 'cluster:admin/opendistro/reports/menu/download'

    # Allows users to use all asynchronous-search functionality
    asynchronous_search_full_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/asynchronous_search/*'
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - 'indices:data/read/search*'

    # Allows users to read stored asynchronous-search results
    asynchronous_search_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opendistro/asynchronous_search/get'

    # Allows user to use all index_management actions - ism policies, rollups, transforms
    index_management_full_access:
        reserved: true
        cluster_permissions:
        - "cluster:admin/opendistro/ism/*"
        - "cluster:admin/opendistro/rollup/*"
        - "cluster:admin/opendistro/transform/*"
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - 'indices:admin/opensearch/ism/*'

    # Allows users to use all cross cluster replication functionality at leader cluster
    cross_cluster_replication_leader_full_access:
        reserved: true
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - "indices:admin/plugins/replication/index/setup/validate"
            - "indices:data/read/plugins/replication/changes"
            - "indices:data/read/plugins/replication/file_chunk"

    # Allows users to use all cross cluster replication functionality at follower cluster
    cross_cluster_replication_follower_full_access:
        reserved: true
        cluster_permissions:
        - "cluster:admin/plugins/replication/autofollow/update"
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - "indices:admin/plugins/replication/index/setup/validate"
            - "indices:data/write/plugins/replication/changes"
            - "indices:admin/plugins/replication/index/start"
            - "indices:admin/plugins/replication/index/pause"
            - "indices:admin/plugins/replication/index/resume"
            - "indices:admin/plugins/replication/index/stop"
            - "indices:admin/plugins/replication/index/update"
            - "indices:admin/plugins/replication/index/status_check"

    # Allow users to read ML stats/models/tasks
    ml_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/openserach/ml/stats'
        - 'cluster:admin/opensearch/ml/models/get'
        - 'cluster:admin/opensearch/ml/models/search'
        - 'cluster:admin/opensearch/ml/tasks/get'
        - 'cluster:admin/opensearch/ml/tasks/search'

    # Allows users to read Notifications config/channels
    notifications_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opensearch/notifications/configs/get'
        - 'cluster:admin/opensearch/notifications/features'
        - 'cluster:admin/opensearch/notifications/channels/get'

    # Allows users to see snapshots, repositories, and snapshot management policies
    snapshot_management_read_access:
        reserved: true
        cluster_permissions:
        - 'cluster:admin/opensearch/snapshot_management/policy/get'
        - 'cluster:admin/opensearch/snapshot_management/policy/search'
        - 'cluster:admin/opensearch/snapshot_management/policy/explain'
        - 'cluster:admin/repository/get'
        - 'cluster:admin/snapshot/get'

    # Allows users to use all ML functionality
    ml_full_access:
        reserved: true
        cluster_permissions:
        - 'cluster_monitor'
        - 'cluster:admin/opensearch/ml/*'
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - 'indices_monitor'

    opendistro_security_role:
        reserved: true
        cluster_permissions:
        # For using _cat/indices
        - 'cluster:monitor/state'
        - 'cluster:monitor/health'
        - 'cluster:monitor/nodes/info'
        # To enable read access to ISM
        - cluster:admin/opendistro/ism/policy/search
        - cluster:admin/opendistro/ism/managedindex/explain
        - cluster:admin/opendistro/rollup/search
        - cluster:admin/opendistro/transform/get_transforms
        # To enable read access to various ISM Jobs
        - cluster:admin/opendistro/rollup/explain
        - cluster:admin/opendistro/ism/policy/get
        - cluster:admin/opendistro/rollup/get
        - cluster:admin/opendistro/transform/explain
        - cluster:admin/opendistro/transform/get
        # To enable read access to security analytics
        - cluster:admin/opensearch/securityanalytics/rule/search
        - cluster:admin/opensearch/securityanalytics/detector/search
        - cluster:admin/opensearch/securityanalytics/findings/get
        - cluster:admin/opensearch/securityanalytics/alerts/get
        - cluster:admin/opensearch/securityanalytics/detector/get
        # For using sql join query
        - "indices:data/read/scroll*"
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - "read"
            - "indices:data/read/mget"
            - "indices:data/read/msearch"
            - "indices:data/read/mtv"
            - "indices:admin/get"
            - "indices:admin/aliases/exists*"
            - "indices:admin/aliases/get*"
            - "indices:admin/mappings/get"
            - "indices:data/read/scroll"
            - "indices:monitor/settings/get"
            - "indices:monitor/stats"
        tenant_permissions:
        - tenant_patterns:
            - '*'
            allowed_actions:
            - "kibana_all_read"

    # Allows index-migration.py script to perform indices migration from ElasticSearch to OpenSearch
    index_migration:
        reserved: true
        cluster_permissions:
            - "create_index"
            - "indices:data/write/reindex"
            - "indices:data/write/index"
            - "cluster:monitor/task/get"
            - "indices:data/write/bulk*"
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - "create_index"
            - "indices:data/write/reindex"
            - "indices:data/write/index"
            - "indices:data/write/bulk*"

    bootstrap:
        reserved: true
        cluster_permissions:
        - 'cluster_monitor'
        - 'cluster_manage_index_templates'
        - "cluster:admin/opendistro/ism/*"
        - "cluster:admin/opensearch/notifications/*"
        - "cluster:admin/opendistro/alerting/*"
        - "cluster:admin/reroute"
        - "kibana_all_write"
        - "kibana_all_read"
        - 'indices:data/write/bulk'
        - "indices:data/read/mget"
        - 'indices:data/write/index'
        - 'indices:data/write/update'
        - 'indices:data/write/delete'
        index_permissions:
        - index_patterns:
            - '*'
            allowed_actions:
            - 'indices:admin/opensearch/ism/*'
            - 'indices:admin/index_template/*'
            - 'indices:admin/template/*'
            - 'indices:admin/settings/update'
            - 'indices:admin/delete'
            - 'indices:admin/resize'
            - 'indices:data/write/index'
            - 'indices:data/write/bulk*'
            - 'indices:data/write/update'
            - 'indices:data/write/delete'
            - 'read'
            - 'indices_monitor'
        - index_patterns:
            - '.kibana*'
            allowed_actions:
            - 'crud'
            - 'create_index'

    customer_role:
        reserved: false
        hidden: false
        cluster_permissions:
        - "cluster_composite_ops_ro"
        - "kibana_all_read"
        index_permissions:
        - index_patterns:
        - "*"
        allowed_actions:
        - "read"
        - "kibana_all_read"
        tenant_permissions:
        - tenant_patterns:
        - "global_tenant"
        allowed_actions:
        - "kibana_all_read"
  roles_mapping.yml: |
    _meta:
        config_version: 2
        type: rolesmapping
    all_access:
        backend_roles:
        - admin
        - os-ping
        description: Maps admin to all_access
        reserved: false
    bootstrap:
        reserved: true
        users:
        - bootstrap
    customer_role:
        backend_roles:
        - crein-primary-os-configteam
        description: Maps admin to all_access
        reserved: false
    index_migration:
        reserved: true
        users:
        - indexmigration
    kibana_server:
        reserved: true
        users:
        - kibanaserver
    kibana_user:
        backend_roles:
        - kibanauser
        description: Maps kibanauser to kibana_user
        reserved: false
    logstash:
        backend_roles:
        - logstash
        reserved: false
    logstash_write:
        backend_roles:
        - logstash
        reserved: false
  tenants.yml: |-
    _meta:
        type: "tenants"
        config_version: 2

    # Define your tenants here
  whitelist.yml: |-
    config:
        enabled: false
        requests:
        /_cluster/settings:
            - GET
        /_cat/nodes:
            - GET
